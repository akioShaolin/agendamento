<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Modbus RTU Sniffer</title>
    <style>
            :root {
                --bg: #f2f2f2;
                --card: #ffffff;
                --primary: #1976d2;
                --text: #333;
                --border: #ddd;
                --console-bg: #111;
                --console-text: #0f0;
            }

            body {
                font-family: Arial, Helvetica, sans-serif;
                background: var(--bg);
                padding: 20px;
                color: var(--text);
            }

            .card {
                background: var(--card);
                padding: 20px;
                border-radius: 10px;
                max-width: 420px;
                margin: auto;
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            }

            h2 {
                margin-top: 0;
                text-align: center;
                color: var(--primary);
            }

            h3 {
                margin-bottom: 10px;
            }

            .label {
                font-weight: bold;
                margin-bottom: 5px;
            }

            .value {
                font-size: 1.2em;
                margin-bottom: 10px;
            }

            .inputs input {
                width: 200px;
                padding: 5px;
                margin: 3px;
                text-align: left;
            }

            button {
                background: var(--primary);
                color: #fff;
                border: none;
                padding: 10px 15px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 1em;
            }

            button:hover {
                opacity: 0.9;
            }

            hr {
                border: none;
                border-top: 1px solid var(--border);
                margin: 20px 0;
            }

            /* ===== CONSOLE ===== */
            .console-container {
                max-width: 420px;
                margin: 15px auto 0 auto;
            }

            .console-title {
                font-weight: bold;
                margin-bottom: 5px;
            }

            #console {
                background: var(--console-bg);
                color: var(--console-text);
                font-family: Consolas, monospace;
                font-size: 0.8em;
                padding: 10px;
                border-radius: 8px;
                height: 200px;
                overflow-y: auto;
                white-space: pre-wrap;
                box-shadow: inset 0 0 5px rgba(0,0,0,0.6);
            }
    </style>
</head>
<body>
    <div class="card">
        <h2>Modbus RTU Sniffer</h2>
        <hr />
        <h3>Salvar Arquivo:</h3>
        <div class="inputs">
            <input id="fileName" type="text" value="sniffing_modbus.txt" />
            <button onclick="saveFile()">Salvar</button>
        </div>
        <hr />
        <div class="console-container">
            <div class="console-title">Console:</div>
            <div id="console">Sniffer<br></div>
        </div>        
    </div>
  <script>
    let ws = new WebSocket('ws://192.168.4.1:81/');

    ws.onopen = () => console.log("Conectado ao WebSocket");
    ws.onerror = (e) => console.log("Erro no WebSocket: ", e);
    ws.onclose = () => console.log("WebSocket desconectado");

    ws.onmessage = (e) => {
        let consoleDiv = document.getElementById('console');
        consoleDiv.innerHTML += e.data + '<br>';
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
    };

    function saveFile() {
        let fileName = document.getElementById('fileName').value;
        /* Código para salvar o arquivo no dispositivo do usuário sem utilizar o console */
        let content = document.getElementById('console').innerText;
        let blob = new Blob([content], { type: 'text/plain' });
        let link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

  </script>
</body>